---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import { getCollection } from "astro:content";
import WritingsFilter from "@/components/Filters/WritingsFilter";
import CombinedFilter from "@/components/Filters/CombinedFilter";
import { CardDisplay } from "@/components/Cards/CardDisplay";

const allWritings = await getCollection("writings");

const getTags = () => {
  const postsWithTags = allWritings.filter((i) => i.data.tags);
  let tagSet = new Set<string>();

  if (postsWithTags.length > 0) {
    postsWithTags.forEach((post) =>
      post.data.tags?.forEach((t) => tagSet.add(t)),
    );
  }

  return tagSet.size === 0 ? null : [...tagSet];
};
---

<BaseLayout>
  <Header />
  <main class="layout-base gap-8 py-8">
    <section class="flex flex-col gap-2">
      <CombinedFilter {allWritings} allTags={getTags()} client:load />
      <!-- <WritingsFilter {allWritings} allTags={getTags()} client:load /> -->
      <CardDisplay data={allWritings} client:load />
    </section>
  </main>
  <Footer />
</BaseLayout>
